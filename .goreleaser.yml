project_name: redpanda-connect
version: 1
builds:
  - id: connect
    main: cmd/redpanda-connect/main.go
    binary: redpanda-connect
    # goos: [ windows, darwin, linux, freebsd, openbsd ]
    goos: [ linux ]
    # goarch: [ amd64, arm64 ]
    goarch: [ amd64 ]
    # goarm: [ 6, 7 ]
    ignore:
      - goos: windows
        goarch: arm
      - goos: darwin
        goarch: arm
    env:
      - CGO_ENABLED=0
    ldflags: >
      -s -w
      -X main.Version={{.Version}}
      -X main.DateBuilt={{.Date}}
      -X main.BinaryName=redpanda-connect

#  - id: connect-cloud
#    main: cmd/redpanda-connect-cloud/main.go
#    binary: redpanda-connect
#    goos: [ darwin, linux ]
#    goarch: [ amd64, arm64 ]
#    env:
#      - CGO_ENABLED=0
#    ldflags: >
#      -s -w
#      -X main.Version={{.Version}}
#      -X main.DateBuilt={{.Date}}
#      -X main.BinaryName=redpanda-connect
#
#  - id: connect-community
#    main: cmd/redpanda-connect-community/main.go
#    binary: redpanda-connect
#    goos: [ darwin, linux ]
#    goarch: [ amd64, arm64 ]
#    env:
#      - CGO_ENABLED=0
#    ldflags: >
#      -s -w
#      -X main.Version={{.Version}}
#      -X main.DateBuilt={{.Date}}
#      -X main.BinaryName=redpanda-connect
#
#  - id: connect-lambda
#    main: cmd/serverless/connect-lambda/main.go
#    binary: redpanda-connect-lambda
#    env:
#      - CGO_ENABLED=0
#    goos: [ linux ]
#    goarch: [ amd64 ]
#
#  - id: connect-lambda-al2
#    main: cmd/serverless/connect-lambda/main.go
#    binary: bootstrap
#    env:
#      - CGO_ENABLED=0
#    goos: [ linux ]
#    goarch: [ amd64, arm64 ]

archives:
  - id: connect-binary-only
    builds: [ connect ]
    format: tar.gz
    # If unset, `files` has a default. See https://goreleaser.com/customization/archive/
    # So we set `files` explicitly to a pattern that resolves to nothing.
    files: [ nothing* ]
    name_template: "{{ .ProjectName }}-binary-only_{{ .Version }}_{{ .Os }}_{{ .Arch }}"

#  - id: connect
#    builds: [ connect ]
#    format: tar.gz
#    files:
#      - README.md
#      - CHANGELOG.md
#      - licenses
#  - id: connect-cloud
#    builds: [ connect-cloud ]
#    format: tar.gz
#    name_template: 'redpanda-connect-cloud_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}'
#    files:
#      - README.md
#      - CHANGELOG.md
#      - licenses
#
#  - id: connect-community
#    builds: [ connect-community ]
#    format: tar.gz
#    name_template: 'redpanda-connect-community_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ with .Arm }}v{{ . }}{{ end }}{{ with .Mips }}_{{ . }}{{ end }}{{ if not (eq .Amd64 "v1") }}{{ .Amd64 }}{{ end }}'
#    files:
#      - README.md
#      - CHANGELOG.md
#      - licenses
#
#  - id: connect-lambda
#    builds: [ connect-lambda ]
#    format: zip
#    name_template: "{{ .Binary }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"
#
#  - id: connect-lambda-al2
#    builds: [ connect-lambda-al2 ]
#    format: zip
#    name_template: "redpanda-connect-lambda-al2_{{ .Version }}_{{ .Os }}_{{ .Arch }}"

dist: target/dist
release:
  github:
    # TODO switch back to redpanda-data
    owner: jackietung-redpanda
    name: connect
  # TODO ids: include all the archive IDs, except for connect-binary-only
  prerelease: auto
  disable: false
blobs:
  - provider: s3
    region: us-west-2
    # TODO use the right bucket
    bucket: jackie-test-12345
    ids:
      - connect-binary-only
    directory: "connect/archives/{{.Version}}"
